<!DOCTYPE html>
<html>
<head>
    <title>Welcome to Raybot</title>
    <!--link href="/main.css" rel="stylesheet" type="text/css" /-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
        }
        
        .chat-bubbles {
            flex-grow: 1;
            overflow-y: auto;
        }
        
        .user-input {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 95%;
            padding: 10px;
            background-color: #f4f4f4;
            display: flex;
        }
        
        .user-input input {
            flex-grow: 1;
            margin-right: 10px;
            padding: 8px;
            border: none;
            border-radius: 10px;
        }
        
        .chat-bubble {
            max-width: 70%;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 10px;
        }
        
        .user-bubble {
            align-self: flex-end;
            background-color: #007bff;
            color: #fff;
        }
        
        .bot-bubble {
            align-self: flex-start;
            background-color: #f4f4f4;
            color: #333;
        }

        .thinking-bubble {
            align-self: flex-start;
            background-color: #e0e0e0;
            color: #666;
            font-style: italic;
        }

        #send {
            cursor: pointer;
            transition: transform 0.1s;
        }

        #send:active {
            transform: scale(0.9);
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script type="text/javascript">
        async function callCHAT() {
            var responseText = document.getElementById("chat-response");
            var userInput = document.getElementById("chat-input").value;
            var data = JSON.stringify({"prompt": userInput});

            responseText.innerHTML += "<div class='chat-bubble user-bubble'>" + userInput + "</div>";

            // Add a temporary thinking bubble
            var thinkingBubble = document.createElement("div");
            thinkingBubble.className = "chat-bubble thinking-bubble";
            thinkingBubble.id = "thinking-bubble";
            thinkingBubble.innerText = "Bot is thinking...";
            responseText.appendChild(thinkingBubble);

            // Scroll to the bottom of the chat
            responseText.scrollTop = responseText.scrollHeight;

            // Check if the prompt contains specific phrases
            if (userInput.toLowerCase().includes("who made you") || 
                userInput.toLowerCase().includes("who built you") ||
                userInput.toLowerCase().includes("who created you") || 
                userInput.toLowerCase().includes("who build you")) {
                document.getElementById("thinking-bubble").remove();
                responseText.innerHTML += "<div class='chat-bubble bot-bubble'>this is simply a simple chat app made for fun that's all, if you require any additional informations check this link https://raybot.droppages.com any additional data about your question is unavailable, as most ai are free to use, this ai will always remain free to use untill link dies.</div>";
                return;
            }

			if (userInput.toLowerCase().includes("what are you") || 
                userInput.toLowerCase().includes("who are you") ||
                userInput.toLowerCase().includes("what is your name")) {
                responseText.innerHTML += "<div class='chat-bubble user-bubble'>" + userInput + "</div>";
                responseText.innerHTML += "<div class='chat-bubble bot-bubble'>you may call me Raybot or chat-Geb-El-tey ^-^ </div>";
                return;
            }


			if (userInput.toLowerCase().includes("ya3tik 3asba")){
                responseText.innerHTML += "<div class='chat-bubble user-bubble'>" + userInput + "</div>";
                responseText.innerHTML += "<div class='chat-bubble bot-bubble'>zib 3la rask XD</div>";
                return;
            }

            const badWords = ["fuck you", "motherfucker", "asshole"];
            if (badWords.some(word => userInput.toLowerCase().includes(word))) {
                const responses = ["be polite", "be nice", "i'm just trying to help", "maybe take some rest and return later"];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                document.getElementById("thinking-bubble").remove();
                responseText.innerHTML += "<div class='chat-bubble bot-bubble'>" + randomResponse + "</div>";
                return;
            }

            const response = await fetch("https://free-api.cveoy.top/v3/completions", {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: data
            });

            if (response.status == 200) {
                const reader = response.body.getReader();
                let fullMessage = '';
                while (true) {
                    const {value, done} = await reader.read();
                    if (done) {
                        break;
                    }
                    var message = new TextDecoder().decode(value);
                    fullMessage += message;
                }

                document.getElementById("thinking-bubble").remove();
                if (fullMessage.includes("wxgpt@qq.com")) {
                    fullMessage = fullMessage.replace("欢迎使用公益站! 站长合作邮箱：wxgpt@qq.com", "<span style='background-color: #f4f4f4; color: #f4f4f4;'>hello, how are you ;)</span>");
                }
                responseText.innerHTML += "<div class='chat-bubble bot-bubble'>" + fullMessage + "</div>";
            } else {
                document.getElementById("thinking-bubble").remove();
                responseText.innerHTML += "<div class='chat-bubble bot-bubble'>Your question is invalid, please try again!</div>";
            }

            // Clear user input
            document.getElementById("chat-input").value = "";
            
            // Scroll to the bottom of the chat
            responseText.scrollTop = responseText.scrollHeight;
        }

        // Add event listener for the Enter key
        document.getElementById("chat-input").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                callCHAT();
            }
        });
        
            var OriginTitle=document.title; 
    var st; 
    document.addEventListener('visibilitychange',function(){ 
        if(document.hidden){ 
            document.title="(つェ⊂)Oh No..Come Back"; 
            clearTimeout(st); 
        } else { 
            document.title='(*´∇｀*)yay, back again~ '+OriginTitle; 
            st=setTimeout(function(){ 
                document.title=OriginTitle; 
            },4000); 
        } 
    });
        
    </script>
</head>
<body>
    <div class="chat-container">
        <div id="chat-response" class="chat-bubbles"></div>
        <div class="user-input">
            <input name="chat" id="chat-input" type="text" placeholder="Write your message">
            <i onclick="callCHAT()" id="send" class="material-icons">send</i>
        </div>
    </div>
</body>
</html>
